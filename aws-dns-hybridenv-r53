## AWS Route 53 Hybrid DNS Resolution Architecture

### 1. Basic Hybrid DNS with Route 53 Resolver Endpoints (IPv4)

```
AWS Cloud Region
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                             │
│  ┌─ VPC (10.0.0.0/16) ──────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                                       │  │
│  │  ┌─ Availability Zone A ──────────────┐    ┌─ Availability Zone B ──────────────┐                   │  │
│  │  │                                    │    │                                    │                   │  │
│  │  │ ┌─ Workload Subnet ──────────────┐ │    │ ┌─ Workload Subnet ──────────────┐ │                   │  │
│  │  │ │    10.0.0.0/24                 │ │    │ │    10.0.1.0/24                 │ │                   │  │
│  │  │ │                                │ │    │ │                                │ │                   │  │
│  │  │ │ [🖥️ ] EC2 Instance   ╭─[1]─╮    │ │    │ │ [🖥️ ] EC2 Instance             │ │                   │  │
│  │  │ │                      │DNS │    │ │    │ │                                │ │                   │  │
│  │  │ │ Queries corp.internal╰─────╯   │ │    │ │                                │ │                   │  │
│  │  │ └────────────────────────────────┘ │    │ └────────────────────────────────┘ │                   │  │
│  │  │                                    │    │                                    │                   │  │
│  │  │ ┌─ Endpoint Subnet ──────────────┐ │    │ ┌─ Endpoint Subnet ──────────────┐ │                   │  │
│  │  │ │    10.0.2.0/28                 │ │    │ │    10.0.2.16/28                │ │                   │  │
│  │  │ │                                │ │    │ │                                │ │                   │  │
│  │  │ │ ╭─[3]─╮  ╭─[4]─╮                │ │    │ │ ╭─[3]─╮  ╭─[4]─╮                │ │                   │  │
│  │  │ │ │ IN  │  │OUT │ Inbound        │ │    │ │ │ IN  │  │OUT │ Inbound        │ │                   │  │
│  │  │ │ │     │  │    │ Endpoint       │ │    │ │ │     │  │    │ Endpoint       │ │                   │  │
│  │  │ │ │10.0.│  │    │ 10.0.0.2       │ │    │ │ │     │  │    │                │ │                   │  │
│  │  │ │ │ 0.2 │  │    │                │ │    │ │ │     │  │    │                │ │                   │  │
│  │  │ │ ╰─────╯  ╰──┬─╯ Outbound        │ │    │ │ ╰─────╯  ╰─────╯ Outbound       │ │                   │  │
│  │  │ │            │   Endpoint        │ │    │ │                  Endpoint       │ │                   │  │
│  │  │ └────────────┼───────────────────┘ │    │ └──────────────────────────────────┘ │                   │  │
│  │  └──────────────┼─────────────────────┘    └────────────────────────────────────────┘                   │  │
│  │                 │                                                                                      │  │
│  │ ┌─ Route 53 Resolver ─────────────────────────────────────────────────────────────────────────────────┤  │
│  │ │ ╭─[2]─╮                                                                                              │  │
│  │ │ │R53  │ Forwarding Rule: corp.internal → 172.16.0.2                                                 │  │
│  │ │ │RSLV │                                                                                              │  │
│  │ │ ╰─────╯                                                                                              │  │
│  │ └──────────────────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │                 │                                                                                      │  │
│  │ ┌─ Private Hosted Zone (PHZ) ─────────────────────────────────────────────────────────────────────────┤  │
│  │ │ aws.example100.internal                                                                              │  │
│  │ │ ╭─[10]─╮                                                                                             │  │
│  │ │ │ PHZ   │ VPC Association                                                                            │  │
│  │ │ ╰───────╯                                                                                            │  │
│  │ └──────────────────────────────────────────────────────────────────────────────────────────────────────┤  │
│  └─────────────────┼─────────────────────────────────────────────────────────────────────────────────────┘  │
│                    │                                                                                        │
│     ╭─[5]─╮         │                                                                                        │
│     │VPG  ├─────────┘                                                                                        │
│     ╰─────╯ Virtual Private Gateway                                                                          │
│                    │                                                                                        │
└────────────────────┼────────────────────────────────────────────────────────────────────────────────────────┘
                     │
       ┌─────────────┼──────────────────────┐
       │ AWS Direct Connect              │
       │ OR                              │
       │ AWS Site-to-Site VPN            │
       └─────────────┼──────────────────────┘
                     │
┌────────────────────┼────────────────────────────────────────────────────────────────────────────────────────┐
│ Corporate Data Center (172.16.0.0/16)                                                                     │
│                    │                                                                                      │
│    ╭─[6]─╮          │              ╭─[7]─╮        ╭─[8]─╮        ╭─[9]─╮                                 │
│    │CGW  ├──────────┘              │DNS  │        │CLT  │        │CLT  │                                 │
│    ╰─────╯ Customer Gateway        │RSLV │        │     │        │     │                                 │
│                                    │     │        │172. │        │Quer-│                                 │
│  DNS Resolver: 172.16.0.2          │172. │        │16.0 │        │ies  │                                 │
│  Resolves corp.internal domains    │16.0 │        │.x   │        │aws. │                                 │
│                                    │.2   │        │     │        │ex100│                                 │
│  Forwards aws.example100.internal → ╰─────╯        ╰─────╯        ╰─────╯                                 │
│  Route 53 Inbound Endpoint                                                                               │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────┘

Traffic Flow:
╭─ Outbound (AWS → On-Premises) ─╮    ╭─ Inbound (On-Premises → AWS) ─╮
│ [1] EC2 queries corp.internal   │    │ [6] Client queries aws.ex100   │
│ [2] Route 53 Resolver forwards  │    │ [7] DNS Resolver forwards       │
│ [3] Outbound Endpoint sends     │    │ [8] Inbound Endpoint receives   │
│ [4] Query via VPN/DirectConnect │    │ [9] Route 53 resolves via PHZ   │
│ [5] Corp DNS resolves domain    │    │ [10] Returns AWS internal IP    │
╰─────────────────────────────────╯    ╰─────────────────────────────────╯
```

### 2. Multi-Account Hybrid DNS with Route 53 Profiles

```
AWS Multi-Account Architecture
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                             │
│ ┌─ AWS Account A ──────────────────────┐  ┌─ AWS Shared Services Account ─────────────────────────────────┐ │
│ │                                      │  │                                                               │ │
│ │ ┌─ Spoke VPC A (10.0.0.0/16) ──────┐ │  │ ┌─ Shared Services VPC (10.2.0.0/16) ────────────────────┐   │ │
│ │ │                                  │ │  │ │                                                         │   │ │
│ │ │ ┌─ Workload Subnet ─────────────┐ │ │  │ │ ┌─ Endpoint Subnet ─────────────────────────────────┐   │   │ │
│ │ │ │                              │ │ │  │ │ │                                               │   │   │ │
│ │ │ │ [🖥️ ] EC2 Instance            │ │ │  │ │ │ ╭─[2]─╮  ╭─[2]─╮  Route 53 Resolver          │   │   │ │
│ │ │ │       ╭─[3]─╮                 │ │ │  │ │ │ │ IN  │  │OUT │  Endpoints                  │   │   │ │
│ │ │ │       │DNS │ Queries domains  │ │ │  │ │ │ │     │  │    │                             │   │   │ │
│ │ │ │       ╰─────╯                 │ │ │  │ │ │ ╰─────╯  ╰─────╯                             │   │   │ │
│ │ │ └──────────────────────────────┘ │ │  │ │ └───────────────────────────────────────────────┘   │   │ │
│ │ │                                  │ │  │ │                                                     │   │ │
│ │ │ ┌─ TGW/CWAN Subnet ────────────┐ │ │  │ │ ┌─ TGW/CWAN Subnet ─────────────────────────────┐   │   │ │
│ │ │ │                              │ │ │  │ │ │                                               │   │   │ │
│ │ │ │ 🌐 TGW/CWAN ENI              │ │ │  │ │ │ 🌐 TGW/CWAN ENI                               │   │   │ │
│ │ │ └──────────────────────────────┘ │ │  │ │ └───────────────────────────────────────────────┘   │   │ │
│ │ └──────────────────────────────────┘ │  │ └─────────────────────────────────────────────────────┘   │ │
│ │                                      │  │                                                           │ │
│ │ ┌─ Private Hosted Zone ─────────────┐ │  │ ┌─ Route 53 Forwarding Rule ──────────────────────────┐   │ │
│ │ │ aws.example100.internal          │ │  │ │ Domain: corp.internal                            │   │ │
│ │ │ ╭─[4]─╮                          │ │  │ │ Type: Forward                                    │   │ │
│ │ │ │PHZ-A│                          │ │  │ │ Target: 2001:db8:5678::abcd                     │   │ │
│ │ │ ╰─────╯                          │ │  │ │ Outbound Endpoint: rslvr-out-123456zyxcba       │   │ │
│ │ └──────────────────────────────────┘ │  │ └──────────────────────────────────────────────────┘   │ │
│ └──────────────────────────────────────┘  └───────────────────────────────────────────────────────┘ │
│                                                                                                       │
│ ┌─ AWS Account B ──────────────────────┐                                                              │
│ │                                      │  ┌─ Route 53 Profile Management ─────────────────────────┐   │
│ │ ┌─ Spoke VPC B (10.1.0.0/16) ──────┐ │  │                                                       │   │
│ │ │                                  │ │  │ ╭─[1]─╮    Route 53 Profile (Shared Services)        │   │
│ │ │ ┌─ Workload Subnet ─────────────┐ │ │  │ │R53  │    • Created in Shared Services Account      │   │
│ │ │ │                              │ │ │  │ │PROF │    • Shared via AWS RAM                       │   │
│ │ │ │ [🖥️ ] EC2 Instance            │ │ │  │ ╰─────╯    • Associated with all VPCs               │   │
│ │ │ │                              │ │ │  │             • Admin permissions granted              │   │
│ │ │ └──────────────────────────────┘ │ │  │                                                       │   │
│ │ │                                  │ │  │ Profile Associations:                                 │   │
│ │ │ ┌─ TGW/CWAN Subnet ────────────┐ │ │  │ • VPC A → PHZ aws.example100.internal                │   │
│ │ │ │ 🌐 TGW/CWAN ENI              │ │ │  │ • VPC B → PHZ aws.example200.internal                │   │
│ │ │ └──────────────────────────────┘ │ │  │ • Shared Services VPC → Forwarding Rules             │   │
│ │ └──────────────────────────────────┘ │  └───────────────────────────────────────────────────────┘   │
│ │                                      │                                                              │
│ │ ┌─ Private Hosted Zone ─────────────┐ │         ┌─ AWS Transit Gateway / AWS Cloud WAN ─────┐      │
│ │ │ aws.example200.internal          │ │         │                                           │      │
│ │ │ ╭─[4]─╮                          │ │         │ ╭─[5]─╮  Connects all VPCs               │      │
│ │ │ │PHZ-B│                          │ │         │ │TGW/ │  Route tables configured        │      │
│ │ │ ╰─────╯                          │ │         │ │CWAN │  for DNS traffic               │      │
│ │ └──────────────────────────────────┘ │         │ ╰─────╯                                 │      │
│ └──────────────────────────────────────┘         └─────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                            │
                    ┌───────────────────────┼───────────────────────┐
                    │ AWS Direct Connect                            │
                    │ Transit VIF                                   │
                    │ Direct Connect Gateway                        │
                    └───────────────────────┼───────────────────────┘
                                            │
┌───────────────────────────────────────────┼───────────────────────────────────────────────────────────────┐
│ Corporate Data Center                     │                                                           │
│ (172.16.0.0/16, 2001:db8:5678::/56)     │                                                           │
│                                           │                                                           │
│  ╭─[6]─╮                                 │              ╭─[7]─╮                                      │
│  │CGW  ├─────────────────────────────────┘              │DNS  │ DNS Resolver                        │
│  ╰─────╯ Customer Gateway                                │RSLV │ • Resolves corp.internal domains   │
│                                                          │     │ • Forwards aws.exampleXXX.internal │
│  ╭─[8]─╮  Client queries aws.example100.internal        ╰─────╯   to Route 53 Inbound Endpoints    │
│  │CLT  │  and aws.example200.internal                                                                 │
│  ╰─────╯                                                                                              │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────┘

DNS Resolution Flow:
[1] Route 53 Profiles centrally manage DNS configuration across accounts
[2] Inbound/Outbound Endpoints handle hybrid DNS resolution  
[3] EC2 instances query Route 53 Resolver in their VPC
[4] Private Hosted Zones provide internal AWS domain resolution
[5] Transit Gateway/Cloud WAN connects VPCs for DNS traffic
[6] Customer Gateway connects to AWS over hybrid connection
[7] Corporate DNS Resolver handles on-premises domains
[8] Corporate clients query AWS internal domains
```

### 3. IPv6 Hybrid DNS with DNS64/NAT64

```
AWS IPv6-Only Hybrid DNS Architecture
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ VPC (10.0.0.0/16 + 2001:db8:1234:1a00::/56)                                                               │
│                                                                                                             │
│ ┌─ Availability Zone A ───────────────────────────────────────────────────────────────────────────────────┐ │
│ │                                                                                                         │ │
│ │ ┌─ Workload Subnet (IPv6-only) ──────────────────────────────────────────────────────────────────────┐ │ │
│ │ │ 2001:db8:1234:1a00::/64                                                                             │ │ │
│ │ │                                                                                                     │ │ │
│ │ │ [🖥️ ] EC2 Instance (IPv6-only)                                                                     │ │ │
│ │ │       2001:db8:1234:1a00::abc                                                                       │ │ │
│ │ │       ╭─[1]─╮                                                                                       │ │ │
│ │ │       │DNS │ AAAA Query: app.corp.internal                                                         │ │ │
│ │ │       ╰─────╯                                                                                       │ │ │
│ │ └─────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│ │                                                                                                         │ │
│ │ ┌─ Endpoint Subnet (Dual-stack) ─────────────────────────────────────────────────────────────────────┐ │ │
│ │ │ 10.0.0.0/28 + 2001:db8:1234:1a01::/64                                                              │ │ │
│ │ │                                                                                                     │ │ │
│ │ │ ╭─[3]─╮  ╭─[4]─╮                                 ╭─[5]─╮                                            │ │ │
│ │ │ │ IN  │  │OUT │ Route 53 Resolver Endpoints     │NAT64│ Private NAT Gateway                       │ │ │
│ │ │ │     │  │    │ (IPv4: 10.0.0.2)                │     │ (DNS64 enabled)                           │ │ │
│ │ │ ╰─────╯  ╰────┤ (IPv6: fd00:ec2::253)           ╰─────╯                                            │ │ │
│ │ │               │                                                                                     │ │ │
│ │ └───────────────┼─────────────────────────────────────────────────────────────────────────────────────┘ │ │
│ └─────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┘ │
│                   │                                                                                           │
│ ┌─ Route 53 Resolver ─────────────────────────────────────────────────────────────────────────────────────┐  │
│ │ ╭─[2]─╮                                                                                                  │  │
│ │ │R53  │ Forwarding Rule: corp.internal → 172.16.0.2                                                     │  │
│ │ │RSLV │ DNS64 Synthesis: IPv4 → IPv6 (64:ff9b::/96 + IPv4)                                             │  │
│ │ ╰─────╯                                                                                                  │  │
│ └──────────────────────────────────────────────────────────────────────────────────────────────────────────┤  │
│                   │                                                                                           │
│     ╭─[6]─╮        │                                                                                           │
│     │VPG  ├────────┘                                                                                           │
│     ╰─────╯ Virtual Private Gateway                                                                            │
└─────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┘
                  │
    ┌─────────────┼──────────────────────┐
    │ AWS Direct Connect              │
    │ OR                              │
    │ AWS Site-to-Site VPN            │
    └─────────────┼──────────────────────┘
                  │
┌─────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┐
│ Corporate Data Center (172.16.0.0/16)                                                                      │
│                 │                                                                                           │
│   ╭─[7]─╮        │              ╭─[8]─╮                    ╭─[9]─╮                                           │
│   │CGW  ├────────┘              │DNS  │                    │SRV  │ IPv4 Server                              │
│   ╰─────╯ Customer Gateway      │RSLV │                    │     │ 172.16.0.10                              │
│                                 │     │ DNS Resolver       │172. │                                          │
│   Resolves corp.internal        │172. │ Returns IPv4       │16.0 │ ╭─[10]─╮                                 │
│   domains to IPv4 addresses     │16.0 │ address for        │.10  │ │CONN │ Receives NAT64                   │
│                                 │.2   │ app.corp.internal  │     │ │     │ translated traffic               │
│                                 ╰─────╯                    ╰─────╯ ╰─────╯                                 │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

IPv6 DNS64/NAT64 Flow:
╭─ DNS Resolution ─────────────────────────────╮    ╭─ Traffic Flow ──────────────────────────╮
│ [1] EC2 queries app.corp.internal (AAAA)    │    │ [6] Route table sends traffic to NAT64  │
│ [2] Route 53 forwards to corp DNS resolver  │    │ [7] NAT64 translates IPv6→IPv4           │
│ [3] Outbound Endpoint sends via VPN/DX      │    │ [8] Traffic reaches IPv4 server          │
│ [4] Corp DNS returns IPv4 address           │    │ [9] Response follows reverse path        │
│ [5] DNS64 synthesizes IPv6: 64:ff9b::ac10:a │    │ [10] NAT64 translates IPv4→IPv6 response │
╰──────────────────────────────────────────────╯    ╰──────────────────────────────────────────╯

Key IPv6 Features:
• DNS64: Synthesizes AAAA records from A records using 64:ff9b::/96 prefix
• NAT64: Translates IPv6 traffic to IPv4 for legacy on-premises systems  
• IPv6-only subnets: Reduces IPv4 address usage in AWS
• Dual-stack endpoints: Support both IPv4 and IPv6 for hybrid connectivity
```

### Key Architecture Components

| Component | Purpose | Notes |
|-----------|---------|-------|
| **Route 53 Resolver** | Central DNS service in VPC | Handles queries from EC2 instances |
| **Inbound Endpoint** | Receives DNS queries from on-premises | Allows corp to query AWS domains |
| **Outbound Endpoint** | Sends DNS queries to on-premises | Allows AWS to query corp domains |
| **Forwarding Rules** | Define domain routing | corp.internal → on-premises DNS |
| **Private Hosted Zones** | AWS internal domains | aws.example100.internal |
| **Route 53 Profiles** | Multi-account DNS management | Centralized configuration sharing |
| **DNS64/NAT64** | IPv6-only to IPv4 translation | Enables IPv6-only workloads |

### Use Cases
- **Hybrid DNS**: Seamless name resolution between AWS and on-premises
- **Multi-account**: Centralized DNS management across AWS accounts  
- **IPv6 migration**: Gradual transition to IPv6-only infrastructure
- **Service discovery**: Internal application service resolution
