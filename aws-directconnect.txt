## AWS Direct Connect Traffic Encryption Options

### 1. AWS Site-to-Site VPN to Amazon VPC (Public VIF)

```
Corporate Network (192.168.0.0/16)                         AWS Region
┌─────────────────────────────────────┐                    ┌─────────────────────────────────────────────────────────────┐
│                                     │                    │                                                             │
│  [👤] User                          │                    │  ┌─ VPC (10.0.0.0/16) ──────────────────────────────────┐   │
│                                     │                    │  │                                                       │   │
│  [🖥️ ] Server                       │                    │  │  ┌─ Availability Zone A ──────────────────────────┐   │   │
│                                     │                    │  │  │                                                 │   │   │
│       ╭─[A]─╮                       │                    │  │  │ ┌─ Workload Subnet 1 ─────────────────────────┐ │   │   │
│       │CGW  │ Customer Gateway       │                    │  │  │ │    10.0.0.0/24                           │ │   │   │
│       │     │ • Routes to VPC        │                    │  │  │ │                                         │ │   │   │
│       │     │ • IPSec encryption     │                    │  │  │ │ [🖥️ ] EC2 Instance     ╭─[E]─╮          │ │   │   │
│       ╰─────╯                       │                    │  │  │ │                         │EC2 │          │ │   │   │
│                                     │                    │  │  │ │ Route Table:            ╰─────╯          │ │   │   │
│                                     │                    │  │  │ │ 10.0.0.0/16 → local                      │ │   │   │
│                                     │                    │  │  │ │ 192.168.0.0/16 → vgw-id                 │ │   │   │
│                                     │                    │  │  │ └─────────────────────────────────────────┘ │   │   │
│                                     │                    │  │  └─────────────────────────────────────────────┘   │   │
│                                     │                    │  │                                                       │   │
│                                     │                    │  │  ┌─ Availability Zone B ──────────────────────────┐   │   │
│                                     │                    │  │  │                                                 │   │   │
│                                     │                    │  │  │ ┌─ Workload Subnet 2 ─────────────────────────┐ │   │   │
│                                     │                    │  │  │ │    10.0.1.0/24                           │ │   │   │
│                                     │                    │  │  │ │                                         │ │   │   │
│                                     │                    │  │  │ │ [🖥️ ] EC2 Instance                      │ │   │   │
│                                     │                    │  │  │ │                                         │ │   │   │
│                                     │                    │  │  │ │ Route Table:                            │ │   │   │
│                                     │                    │  │  │ │ 10.0.0.0/16 → local                     │ │   │   │
│                                     │                    │  │  │ │ 192.168.0.0/16 → vgw-id                │ │   │   │
│                                     │                    │  │  │ └─────────────────────────────────────────┘ │   │   │
│                                     │                    │  │  └─────────────────────────────────────────────┘   │   │
│                                     │                    │  │                                                       │   │
│                                     │                    │  │  ╭─[D]─╮                                            │   │
│                                     │                    │  │  │VGW  │ Virtual Private Gateway                    │   │
│                                     │                    │  │  │     │ • VPN Endpoints (Public IPs)               │   │
│                                     │                    │  │  │     │ • IPSec Termination                       │   │
│                                     │                    │  │  ╰─────╯                                            │   │
│                                     │                    │  └───────────────────────────────────────────────────────┘   │
└─────────────────────────────────────┘                    └─────────────────────────────────────────────────────────────┘
              │                                                                      ▲
              │ ╭─[B]─╮                                                               │ ╭─[C]─╮
              └─┤DX   ├───────────────────────────────────────────────────────────────┤VPN  │
                │PubVIF│ Direct Connect Public VIF                                    │     │
                ╰─────╯                                                               ╰─────╯
                  │                                                                     
                  │                                                AWS Site-to-Site VPN
┌─────────────────┼─────────────────────────────────────────┐      (IPSec Encrypted)
│ AWS Direct Connect Location                               │
│                 │                                         │
│  ╭─[1]─╮        │        ╭─[2]─╮                          │
│  │AWS  ├────────┼────────┤CUST │ Customer/Partner Device  │
│  │DEV  │ Cross-Connect    │DEV  │                          │
│  ╰─────╯        │        ╰─────╯                          │
│                 │                                         │
└─────────────────┼─────────────────────────────────────────┘
                  │
     Direct Connect Connection

Traffic Flow:
[A] User → CGW: Route to 10.0.0.x
[B] CGW → DX Public VIF: Encrypted IPSec packets to VPN endpoint
[C] DX → VPN: Reach VPN endpoint public IP
[D] VPN → VGW: Decrypt and route to VPC
[E] VGW → EC2: Route to target instance

Steps:
[1] Create Direct Connect connection
[2] Create Direct Connect Public VIF  
[3] Create Site-to-Site VPN to VGW
[4] Configure BGP on Public VIF
[5] Configure IPSec on Customer Gateway
```

### 2. AWS Site-to-Site VPN to Transit Gateway (Public VIF)

```
Corporate Network (192.168.0.0/16)                         AWS Region
┌─────────────────────────────────────┐                    ┌─────────────────────────────────────────────────────────────┐
│                                     │                    │                                                             │
│  [👤] User                          │                    │ ┌─ Spoke VPC A (10.0.0.0/16) ──────────────────────────────┐ │
│                                     │                    │ │                                                           │ │
│  [🖥️ ] Server                       │                    │ │  ┌─ AZ A ──────────────────────────────────────────────┐   │ │
│                                     │                    │ │  │                                                   │   │ │
│       ╭─[A]─╮                       │                    │ │  │ ┌─ Transit GW Subnet ─────────────────────────────┐ │   │ │
│       │CGW  │ Customer Gateway       │                    │ │  │ │    10.0.0.0/24                               │ │   │ │
│       │     │ • Multi-VPC routing    │                    │ │  │ │ 🌐 ENI                                       │ │   │ │
│       │     │ • IPSec to TGW         │                    │ │  │ └─────────────────────────────────────────────┘ │   │ │
│       ╰─────╯                       │                    │ │  │                                                   │   │ │
│                                     │                    │ │  │ ┌─ Workload Subnet ──────────────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.0.1.0/24                              │ │   │ │
│                                     │                    │ │  │ │ [🖥️ ] EC2 Instance     ╭─[F]─╮              │ │   │ │
│                                     │                    │ │  │ │                         │EC2A│              │ │   │ │
│                                     │                    │ │  │ │ Route: 0.0.0.0/0 → tgw ╰─────╯              │ │   │ │
│                                     │                    │ │  │ └─────────────────────────────────────────────┘ │   │ │
│                                     │                    │ │  └───────────────────────────────────────────────┘   │ │
│                                     │                    │ └───────────────────────────────────────────────────────┘ │
│                                     │                    │                                    │                     │
│                                     │                    │                                    │ VPC Association     │
│                                     │                    │                                    ▼                     │
│                                     │                    │ ┌─ AWS Transit Gateway ──────────────────────────────────┐ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ╭─[D]─╮   VPN Route Table:                          │ │
│                                     │                    │ │  │TGW  │   • 10.0.0.0/24 → Spoke VPC A              │ │
│                                     │                    │ │  │     │   • 10.1.0.0/24 → Spoke VPC B              │ │
│                                     │                    │ │  ╰─────╯                                             │ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ╭─[E]─╮   Spoke Route Table:                        │ │
│                                     │                    │ │  │VPN  │   • 192.168.0.0/16 → S2S VPN               │ │
│                                     │                    │ │  │ATT  │                                             │ │
│                                     │                    │ │  ╰─────╯                                             │ │
│                                     │                    │ └───────────────────────────────────────────────────────┘ │
│                                     │                    │                                    │                     │
│                                     │                    │                                    │ VPC Association     │
│                                     │                    │                                    ▼                     │
│                                     │                    │ ┌─ Spoke VPC B (10.1.0.0/16) ──────────────────────────┐ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ┌─ AZ A ──────────────────────────────────────────┐   │ │
│                                     │                    │ │  │                                               │   │ │
│                                     │                    │ │  │ ┌─ Transit GW Subnet ───────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.1.0.0/24                         │ │   │ │
│                                     │                    │ │  │ │ 🌐 ENI                                 │ │   │ │
│                                     │                    │ │  │ └───────────────────────────────────────┘ │   │ │
│                                     │                    │ │  │                                               │   │ │
│                                     │                    │ │  │ ┌─ Workload Subnet ────────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.1.1.0/24                        │ │   │ │
│                                     │                    │ │  │ │ [🖥️ ] EC2 Instance                    │ │   │ │
│                                     │                    │ │  │ │ Route: 0.0.0.0/0 → tgw               │ │   │ │
│                                     │                    │ │  │ └───────────────────────────────────────┘ │   │ │
│                                     │                    │ │  └───────────────────────────────────────────┘   │ │
│                                     │                    │ └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────┘                    └─────────────────────────────────────────────────────────────┘
              │                                                                      ▲
              │ ╭─[B]─╮                                                               │ ╭─[C]─╮
              └─┤DX   ├───────────────────────────────────────────────────────────────┤VPN  │
                │PubVIF│ Direct Connect Public VIF                                    │     │
                ╰─────╯                                                               ╰─────╯
                  │                                                                     
                  │                                                AWS Site-to-Site VPN
┌─────────────────┼─────────────────────────────────────────┐      (IPSec Encrypted)
│ AWS Direct Connect Location                               │      to Transit Gateway
│                 │                                         │
│  ╭─[1]─╮        │        ╭─[2]─╮                          │
│  │AWS  ├────────┼────────┤CUST │ Customer/Partner Device  │
│  │DEV  │ Cross-Connect    │DEV  │                          │
│  ╰─────╯        │        ╰─────╯                          │
└─────────────────┼─────────────────────────────────────────┘

Traffic Flow:
[A] User → CGW: Route to spoke VPCs
[B] CGW → DX Public VIF: Encrypted IPSec to TGW VPN endpoint
[C] DX → VPN: Reach TGW VPN endpoint public IP
[D] VPN → TGW: Decrypt and route via TGW
[E] TGW → Spoke VPCs: Forward to target VPC
[F] VPC → EC2: Route to target instance
```

### 3. AWS Site-to-Site VPN Private IP VPN to Transit Gateway

```
Corporate Data Center (192.168.0.0/16)                     AWS Region
┌─────────────────────────────────────┐                    ┌─────────────────────────────────────────────────────────────┐
│                                     │                    │                                                             │
│  [👤] User                          │                    │ ┌─ Spoke VPC A (10.0.0.0/16) ──────────────────────────────┐ │
│                                     │                    │ │                                                           │ │
│  [🖥️ ] Server                       │                    │ │  ┌─ AZ A ──────────────────────────────────────────────┐   │ │
│                                     │                    │ │  │                                                   │   │ │
│       ╭─[A]─╮                       │                    │ │  │ ┌─ Transit GW Subnet ─────────────────────────────┐ │   │ │
│       │CGW  │ Customer Gateway       │                    │ │  │ │    10.0.1.0/28                               │ │   │ │
│       │     │ • Private IP VPN       │                    │ │  │ │ 🌐 ENI                                       │ │   │ │
│       │     │ • Enhanced security    │                    │ │  │ └─────────────────────────────────────────────┘ │   │ │
│       ╰─────╯                       │                    │ │  │                                                   │   │ │
│                                     │                    │ │  │ ┌─ Workload Subnet ──────────────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.0.0.0/24                              │ │   │ │
│                                     │                    │ │  │ │ [🖥️ ] EC2 Instance     ╭─[D]─╮              │ │   │ │
│                                     │                    │ │  │ │                         │EC2A│              │ │   │ │
│                                     │                    │ │  │ │ Route: 0.0.0.0/0 → tgw ╰─────╯              │ │   │ │
│                                     │                    │ │  │ └─────────────────────────────────────────────┘ │   │ │
│                                     │                    │ │  └───────────────────────────────────────────────┘   │ │
│                                     │                    │ └───────────────────────────────────────────────────────┘ │
│                                     │                    │                                    │                     │
│                                     │                    │                                    │ VPC Association     │
│                                     │                    │                                    ▼                     │
│                                     │                    │ ┌─ AWS Transit Gateway ──────────────────────────────────┐ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ╭─[C]─╮   VPN Route Table:                          │ │
│                                     │                    │ │  │TGW  │   • 10.0.0.0/16 → Spoke VPC A              │ │
│                                     │                    │ │  │     │   • 10.1.0.0/16 → Spoke VPC B              │ │
│                                     │                    │ │  ╰─────╯                                             │ │
│                                     │                    │ │              ▲                                       │ │
│                                     │                    │ │              │ VPN Attachment                        │ │
│                                     │                    │ │              │                                       │ │
│                                     │                    │ │  ╭─────────────────────────────────────────────────╮ │ │
│                                     │                    │ │  │ AWS Site-to-Site VPN (Private IP)             │ │ │
│                                     │                    │ │  │ • Uses Direct Connect Gateway as transport   │ │ │
│                                     │                    │ │  │ • Private IP addresses for VPN endpoints     │ │ │
│                                     │                    │ │  │ • Enhanced security and network privacy      │ │ │
│                                     │                    │ │  ╰─────────────────────────────────────────────────╯ │ │
│                                     │                    │ └───────────────────────────────────────────────────────┘ │
│                                     │                    │                                    │                     │
│                                     │                    │                                    │ VPC Association     │
│                                     │                    │                                    ▼                     │
│                                     │                    │ ┌─ Spoke VPC B (10.1.0.0/16) ──────────────────────────┐ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ┌─ AZ A ──────────────────────────────────────────┐   │ │
│                                     │                    │ │  │                                               │   │ │
│                                     │                    │ │  │ ┌─ Transit GW Subnet ───────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.1.1.0/28                         │ │   │ │
│                                     │                    │ │  │ │ 🌐 ENI                                 │ │   │ │
│                                     │                    │ │  │ └───────────────────────────────────────┘ │   │ │
│                                     │                    │ │  │                                               │   │ │
│                                     │                    │ │  │ ┌─ Workload Subnet ────────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.1.0.0/24                        │ │   │ │
│                                     │                    │ │  │ │ [🖥️ ] EC2 Instance                    │ │   │ │
│                                     │                    │ │  │ │ Route: 0.0.0.0/0 → tgw               │ │   │ │
│                                     │                    │ │  │ └───────────────────────────────────────┘ │   │ │
│                                     │                    │ │  └───────────────────────────────────────────┘   │ │
│                                     │                    │ └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────┘                    └─────────────────────────────────────────────────────────────┘
              │                                                                      ▲
              │ ╭─[B]─╮                                                               │ Private IP VPN
              └─┤DX   ├───────────────────────────────────────────────────────────────┤ over Transit VIF
                │TrVIF│ Direct Connect Transit VIF                                   │ 
                ╰─────╯                                                               │
                  │                                 ╭─────────────────────────────────╯
                  │                                 │ Direct Connect Gateway
                  │                                 │ • Gateway association with TGW
┌─────────────────┼─────────────────────────────────┼─────────────────────────────────┐
│ AWS Direct Connect Location           ╭─────────────────╮                          │
│                 │                     │DX Gateway       │                          │
│  ╭─[1]─╮        │        ╭─[2]─╮      │• Private routing│                          │
│  │AWS  ├────────┼────────┤CUST │      │• VPN transport  │                          │
│  │DEV  │ Cross-Connect    │DEV  │      ╰─────────────────╯                          │
│  ╰─────╯        │        ╰─────╯                                                   │
└─────────────────┼─────────────────────────────────────────────────────────────────┘
                  │
     Direct Connect Connection (Transit VIF + DX Gateway)

Traffic Flow:
[A] User → CGW: Route to spoke VPCs via Private IP VPN
[B] CGW → DX Transit VIF: Private IP VPN over Direct Connect
[C] DX Gateway → TGW: Route via VPN attachment  
[D] TGW → Spoke VPC: Forward to target VPC and EC2 instance

Key Features:
• Private IP addresses for VPN endpoints
• Uses Direct Connect Gateway and Transit VIF as transport
• Enhanced security - no public IP exposure
• Native Direct Connect routing integration
```

### 4. MACsec Security in AWS Direct Connect

```
Corporate Network (192.168.0.0/16)                         AWS Region
┌─────────────────────────────────────┐                    ┌─────────────────────────────────────────────────────────────┐
│                                     │                    │                                                             │
│  [👤] User                          │                    │ ┌─ Spoke VPC A (10.0.0.0/16) ──────────────────────────────┐ │
│                                     │                    │ │                                                           │ │
│  [🖥️ ] Server                       │                    │ │  ┌─ AZ A ──────────────────────────────────────────────┐   │ │
│                                     │                    │ │  │                                                   │   │ │
│       ╭─[A]─╮                       │                    │ │  │ ┌─ Transit GW Subnet ─────────────────────────────┐ │   │ │
│       │CGW  │ Customer Gateway       │                    │ │  │ │    10.0.0.0/24                               │ │   │ │
│       │     │ • Native DX routing    │                    │ │  │ │ 🌐 ENI                                       │ │   │ │
│       │     │ • No VPN overhead      │                    │ │  │ └─────────────────────────────────────────────┘ │   │ │
│       ╰─────╯                       │                    │ │  │                                                   │   │ │
│                                     │                    │ │  │ ┌─ Workload Subnet ──────────────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.0.1.0/24                              │ │   │ │
│                                     │                    │ │  │ │ [🖥️ ] EC2 Instance     ╭─[D]─╮              │ │   │ │
│                                     │                    │ │  │ │                         │EC2A│              │ │   │ │
│                                     │                    │ │  │ │ Route: 0.0.0.0/0 → tgw ╰─────╯              │ │   │ │
│                                     │                    │ │  │ └─────────────────────────────────────────────┘ │   │ │
│                                     │                    │ │  └───────────────────────────────────────────────┘   │ │
│                                     │                    │ └───────────────────────────────────────────────────────┘ │
│                                     │                    │                                    │                     │
│                                     │                    │                                    │ VPC Association     │
│                                     │                    │                                    ▼                     │
│                                     │                    │ ┌─ AWS Transit Gateway ──────────────────────────────────┐ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ╭─[C]─╮   Direct Connect Route Table:                │ │
│                                     │                    │ │  │TGW  │   • 10.0.0.0/24 → Spoke VPC A              │ │
│                                     │                    │ │  │     │   • 10.1.0.0/24 → Spoke VPC B              │ │
│                                     │                    │ │  ╰─────╯                                             │ │
│                                     │                    │ │              ▲                                       │ │
│                                     │                    │ │              │ Gateway Association                    │ │
│                                     │                    │ │              │                                       │ │
│                                     │                    │ │  ╭─────────────────────────────────────────────────╮ │ │
│                                     │                    │ │  │ AWS Direct Connect Gateway                    │ │ │
│                                     │                    │ │  │ • Native Layer 2/3 routing                   │ │ │
│                                     │                    │ │  │ • No VPN encapsulation overhead             │ │ │
│                                     │                    │ │  │ • MACsec encryption at wire speed           │ │ │
│                                     │                    │ │  ╰─────────────────────────────────────────────────╯ │ │
│                                     │                    │ └───────────────────────────────────────────────────────┘ │
│                                     │                    │                                    │                     │
│                                     │                    │                                    │ VPC Association     │
│                                     │                    │                                    ▼                     │
│                                     │                    │ ┌─ Spoke VPC B (10.1.0.0/16) ──────────────────────────┐ │
│                                     │                    │ │                                                       │ │
│                                     │                    │ │  ┌─ AZ A ──────────────────────────────────────────┐   │ │
│                                     │                    │ │  │                                               │   │ │
│                                     │                    │ │  │ ┌─ Transit GW Subnet ───────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.1.0.0/24                         │ │   │ │
│                                     │                    │ │  │ │ 🌐 ENI                                 │ │   │ │
│                                     │                    │ │  │ └───────────────────────────────────────┘ │   │ │
│                                     │                    │ │  │                                               │   │ │
│                                     │                    │ │  │ ┌─ Workload Subnet ────────────────────────┐ │   │ │
│                                     │                    │ │  │ │    10.1.1.0/24                        │ │   │ │
│                                     │                    │ │  │ │ [
